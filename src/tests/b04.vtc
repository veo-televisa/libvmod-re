varnishtest "test null match (varnish r00913.vtc)"

server s1 {
	rxreq
	txresp -body "foobar"
} -start

varnish v1 -vcl+backend {
	import re from "${vmod_topbuild}/src/.libs/libvmod_re.so";

	sub vcl_fetch {
		if (re.match(beresp.http.bar, "$")) {
			set beresp.http.foo = "XXX";
		}
		if (re.match(beresp.http.foo, "")) {
			set beresp.http.bar = "YYY";
		}
		if (re.match_dyn(beresp.http.bar, "$")) {
			set beresp.http.food = "XXX";
		}
		if (re.match_dyn(beresp.http.foo, "")) {
			set beresp.http.bard = "YYY";
		}
	}
} -start

client c1 {
	txreq
	rxresp 
	expect resp.http.content-length == 6
	expect resp.http.foo == "XXX"
	expect resp.http.bar == "YYY"
	expect resp.http.food == "XXX"
	expect resp.http.bard == "YYY"
} -run
